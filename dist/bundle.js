(()=>{"use strict";var e,t={703:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApiService=void 0;var n=function(){function e(e){this.BASE_URL="https://api.poetizer.com",this.deviceToken=e}return e.prototype.getPoemsByTags=function(e,t,n){return fetch("".concat(this.BASE_URL,"/poems/search?limit=").concat(e,"&offset=").concat(t),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Device-token ".concat(this.deviceToken)},body:n}).then((function(e){return e.json()})).then((function(e){return e}))},e}();t.ApiService=n}},n={};e=function e(o){var a=n[o];if(void 0!==a)return a.exports;var r=n[o]={exports:{}};return t[o](r,r.exports,e),r.exports}(703),function(){var t,n,o="https://api.poetizer.com",a="https://poetizer.com",r=window.localStorage.getItem("device_token"),c=window.localStorage.getItem("user_id"),i=window.localStorage.getItem("user_name"),l=window.localStorage.getItem("picture_url"),d=window.localStorage.getItem("expiration"),u=!1;function m(){fetch("".concat(o,"/users/").concat(c),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Device-token ".concat(r)}}).then((function(e){return e.json()})).then((function(e){document.getElementById("id01").style.display="none";var t=document.createElement("img");l=e.picture,t.src=l,window.localStorage.setItem("picture_url",l);var n=document.createElement("p");i=e.name,n.innerText="Jste přihlášen pod účtem: ".concat(i),window.localStorage.setItem("user_name",i);var o=document.createElement("button");o.onclick=function(){return p()},o.setAttribute("id","logout-button"),o.innerText="Log out";var a=document.getElementById("login-area");a.innerHTML=t.outerHTML,a.innerHTML+=n.outerHTML,a.appendChild(o)}))}function s(){var e,t=document.getElementById("uname"),n=document.getElementById("psw");null!=t&&null!=n&&(e={email:t.value,password:n.value,platform:"android",device_name:"Randomdroid 9"},fetch("".concat(o,"/devices/email"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){if(201===e.status)return e.json();var t=new Error("promise chain cancelled getToken");throw t.name="CancelPromiseChainError",t})).then((function(e){r=e.device_token,window.localStorage.setItem("device_token",r),c=e.user_id,window.localStorage.setItem("user_id",c);var t=e.jwt.access.split(".")[1],n=JSON.parse(atob(t));d=n.exp,window.localStorage.setItem("expiration",d),m()})).catch((function(e){"CancelPromiseChainError"==e.name&&(document.getElementById("login-info").innerText="Přihlášení se nepodařilo")})))}function p(){window.localStorage.clear(),location.reload()}function g(){document.getElementById("main").innerHTML="",h(6,0)}function h(t,n){var o;0!=v().length&&null!=r&&+d>Date.now()/1e3?(o=document.getElementById("tags").value.trim(),document.getElementById("stats").innerText="Hledané tagy: ".concat(o.replace(/\s+/g,"").replace(/,/g,", ")),new e.ApiService(r).getPoemsByTags(t,n,v()).then((function(e){var n=document.getElementById("main");if(0==e.poems.length){var o="Pro tento tag nebyly nalezeny žádné básně";u||(n.innerText=o),E(o)}else e.poems.forEach((function(e){var t=document.createElement("article"),o=document.createElement("a");o.href="".concat(a,"/poem/").concat(e.id),o.target="_blank";var r=document.createElement("h2");r.innerText=e.title,o.appendChild(r);var c=document.createElement("p");c.insertAdjacentHTML("afterbegin",e.text);var i=document.createElement("a");i.href="".concat(a,"/author/").concat(e.author.id),i.target="_blank",i.innerText=e.author.name;var l=document.createElement("p");l.innerText="Tags: ".concat(e.tags),t.appendChild(o),t.appendChild(c),t.insertAdjacentHTML("beforeend","Autor: ".concat(i.outerHTML)),t.appendChild(l),n.appendChild(t)})),e.poems.length==t&&(f(e.next),y()),e.poems.length<t&&E("Žádné další básně")})).catch((function(e){"CancelPromiseChainError"==e.name&&(document.getElementById("main").innerText="Špatně zadaný tag, obsahuje nevyhledatelné znaky. Používejte pouze písmena a čárky.")}))):document.getElementById("main").innerText="Zadejte tag do vyhledávacího políčka. Před vyhledáváním se ujistěte, že jste přihlášení, případně tak učiňte kliknutím na tlačítko Login"}function v(){var e=document.getElementById("tags").value.trim();return 0==e.length||"Zadej tag"==e?(document.getElementById("main").innerText="Nezadali jste žádný tag do vyhledávacího okýnka :)",""):'{"tags":["'.concat(e.replace(/\s+/g,"").replace(/,/g,'", "'),'"]}')}function f(e){var o=e.split("="),a=o[1].split("&");t=+a[0],n=+o[2]}function y(){var e;u?((e=document.getElementById("next-poem-button")).onclick=function(){return h(t,n)},e.innerText="Další básně"):((e=document.createElement("button")).onclick=function(){return h(t,n)},e.setAttribute("id","next-poem-button"),e.innerText="Další básně",document.getElementById("next-area").appendChild(e)),u=!0}function E(e){var t=document.getElementById("next-poem-button");t.onclick=function(){},t.innerText=e}window.onload=function(){document.querySelector("#tags").addEventListener("keypress",(function(e){"Enter"===e.key&&g()})),document.querySelector("#psw").addEventListener("keypress",(function(e){"Enter"===e.key&&s()})),document.querySelector("#log-me-button").addEventListener("click",(function(e){s()})),document.querySelector("#search-submit").addEventListener("click",(function(e){g()})),null!=r&&+d>Date.now()/1e3&&(null!=i?function(){document.getElementById("id01").style.display="none";var e=document.createElement("img");l=window.localStorage.getItem("picture_url"),e.src=l;var t=document.createElement("p");i=window.localStorage.getItem("user_name"),t.innerText="Jste přihlášen pod účtem: ".concat(i);var n=document.createElement("button");n.onclick=function(){return p()},n.setAttribute("id","logout-button"),n.innerText="Log out";var o=document.getElementById("login-area");o.innerHTML=e.outerHTML,o.innerHTML+=t.outerHTML,o.appendChild(n)}():m())}}()})();